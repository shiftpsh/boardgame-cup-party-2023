(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6460],{5873:function(e,s,n){"use strict";n.d(s,{Z:function(){return r}});var r=(0,n(777).Z)("plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]])},2166:function(e,s,n){"use strict";n.d(s,{Z:function(){return r}});var r=(0,n(777).Z)("trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]])},6976:function(e,s,n){Promise.resolve().then(n.bind(n,8787))},8787:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return S}});var r=n(9268),l=n(5002),t=n(3328),i=n(1835),d=n(8941),a=n(4890),c=n(5846),h=n.n(c),u=n(6006),o=n(475),x=n(5873),j=n(1313),m=n(2805),p=n(3335);function g(){let e=(0,m._)(["\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n"]);return g=function(){return e},e}function f(){let e=(0,m._)(["\n  display: flex;\n  align-items: center;\n  gap: 0 16px;\n"]);return f=function(){return e},e}let v=p.default.img(g()),b=p.default.div(f()),L=e=>{let{adminUIDs:s,users:n}=e,l=(0,o.Ds)(),[d,c]=(0,u.useState)(""),h=(0,u.useMemo)(()=>new Set(s),[s]),m=(0,u.useMemo)(()=>{let e=d.toLocaleLowerCase();return Array.from(n.values()).filter(s=>!h.has(s.uid)&&!!(s.email.toLocaleLowerCase().includes(e)||s.name.toLocaleLowerCase().includes(e)||s.uid.toLocaleLowerCase().includes(e)))},[h,d,n]),p=async e=>{try{await (0,a.t8)((0,a.iH)(t.db,"admin_emails/"+e),!0),l.enqueue({message:"관리자를 추가했습니다.",severity:"success"})}catch(e){console.error(e),e instanceof j.ZR?l.enqueue({message:"관리자 추가에 실패했습니다: ".concat(e.message),severity:"error"}):l.enqueue({message:"관리자 추가에 실패했습니다.",severity:"error"})}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.qo,{fullWidth:!0,placeholder:"이메일, 이름, UID, ...",value:d,onChange:e=>c(e.target.value)}),(0,r.jsx)(i.Jd,{h3:!0,children:"검색 결과"}),0===m.length?(0,r.jsx)(i.at,{children:"검색 결과가 없습니다."}):(0,r.jsx)(i.xJ,{children:(0,r.jsxs)(i.iA,{fullWidth:!0,children:[(0,r.jsx)(i.ss,{children:(0,r.jsxs)(i.X2,{children:[(0,r.jsx)(i.bL,{width:"60%",children:"이름"}),(0,r.jsx)(i.bL,{width:"20%",children:"UID"}),(0,r.jsx)(i.bL,{width:"20%",children:"추가"})]})}),(0,r.jsx)(i.RM,{children:m.map(e=>{let{uid:s}=e;return(0,r.jsxs)(i.X2,{children:[(0,r.jsx)(i.bL,{style:{verticalAlign:"middle"},children:(0,r.jsxs)(b,{children:[(0,r.jsx)(v,{src:e.photoURL,alt:e.name+"의 프로필 사진"}),(0,r.jsxs)("div",{children:[e.name,(0,r.jsx)("br",{}),(0,r.jsx)(i.Jd,{description:!0,small:!0,children:e.email})]})]})}),(0,r.jsx)(i.bL,{style:{verticalAlign:"middle"},children:(0,r.jsx)(i.Jd,{small:!0,children:s})}),(0,r.jsx)(i.bL,{children:(0,r.jsx)(i.zx,{fullWidth:!0,transparent:!0,onClick:()=>p(s),children:(0,r.jsx)(x.Z,{})})})]},s)})})]})})]})};var y=n(2166);let k=e=>{let{adminUIDs:s,users:n}=e,d=(0,l.aC)(),c=(0,o.Ds)(),h=async e=>{try{await (0,a.Od)((0,a.iH)(t.db,"admin_emails/"+e)),c.enqueue({message:"관리자를 삭제했습니다.",severity:"success"})}catch(e){console.error(e),e instanceof j.ZR?c.enqueue({message:"관리자 삭제에 실패했습니다: ".concat(e.message),severity:"error"}):c.enqueue({message:"관리자 삭제에 실패했습니다.",severity:"error"})}};return s.length?(0,r.jsx)(i.xJ,{children:(0,r.jsxs)(i.iA,{fullWidth:!0,children:[(0,r.jsx)(i.ss,{children:(0,r.jsxs)(i.X2,{children:[(0,r.jsx)(i.bL,{width:"60%",children:"이름"}),(0,r.jsx)(i.bL,{width:"20%",children:"UID"}),(0,r.jsx)(i.bL,{width:"20%",children:"삭제"})]})}),(0,r.jsx)(i.RM,{children:s.map(e=>{var s,l;let t=n.get(e);return(0,r.jsxs)(i.X2,{children:[t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.bL,{style:{verticalAlign:"middle"},children:(0,r.jsxs)(b,{children:[(0,r.jsx)(v,{src:t.photoURL,alt:t.name+"의 프로필 사진"}),(0,r.jsxs)("div",{children:[t.name,(null==d?void 0:null===(s=d.user)||void 0===s?void 0:s.uid)===e&&(0,r.jsxs)(r.Fragment,{children:[" ",(0,r.jsx)(i.Jd,{description:!0,children:"(나)"})]}),(0,r.jsx)("br",{}),(0,r.jsx)(i.Jd,{description:!0,small:!0,children:t.email})]})]})}),(0,r.jsx)(i.bL,{style:{verticalAlign:"middle"},children:(0,r.jsx)(i.Jd,{small:!0,children:e})})]}):(0,r.jsx)(i.bL,{colSpan:2,children:(0,r.jsx)(i.Jd,{description:!0,children:e})}),(0,r.jsx)(i.bL,{children:(null==d?void 0:null===(l=d.user)||void 0===l?void 0:l.uid)!==e&&(0,r.jsx)(i.zx,{fullWidth:!0,transparent:!0,onClick:()=>h(e),children:(0,r.jsx)(y.Z,{})})})]},e)})})]})}):(0,r.jsx)(i.at,{children:"관리자가 없습니다."})};var w=n(6994);let M=()=>{let{scoreboard:e}=(0,w.ek)(),s=(0,u.useMemo)(()=>{let s=new Map,n=e.map(e=>({handle:e.handle,score:e.scoreEntries.reduce((e,s)=>e+s.score,0),lastScoreUpdateTime:e.lastScoreUpdateTime,user:e})).filter(e=>!e.user.exclude).sort((e,s)=>e.score===s.score?e.lastScoreUpdateTime-s.lastScoreUpdateTime:s.score-e.score).map((e,n)=>{let r="".concat(e.score,"-").concat(e.lastScoreUpdateTime);if(s.has(r))return{...e,rank:s.get(r)};let l={...e,rank:n+1};return s.set(r,n+1),l});return n},[e]),n=(0,u.useMemo)(()=>{let e=new Map;return s.forEach(s=>{e.set(s.handle,s.rank)}),e},[s]),r=(0,u.useMemo)(()=>{let s=e.map(e=>({handle:e.handle,count:e.scoreEntries.filter(e=>"game"in e&&1===e.result.rank).length,user:e})).filter(e=>!e.user.exclude).sort((e,s)=>e.count===s.count?n.get(e.handle)-n.get(s.handle):s.count-e.count);return s},[n,e]),l=(0,u.useMemo)(()=>{let s=e.map(e=>({handle:e.handle,count:e.scoreEntries.filter(e=>"game"in e&&e.result.rank===e.game.result.length).length,user:e})).filter(e=>!e.user.exclude).sort((e,s)=>e.count===s.count?n.get(e.handle)-n.get(s.handle):s.count-e.count);return s},[n,e]),t=(0,u.useMemo)(()=>{let s=e.map(e=>({handle:e.handle,minutes:e.scoreEntries.map(e=>"game"in e?e.game.durationMinutes:0).reduce((e,s)=>Math.max(e,s),0),user:e})).filter(e=>!e.user.exclude).sort((e,s)=>e.minutes===s.minutes?n.get(e.handle)-n.get(s.handle):s.minutes-e.minutes);return s},[n,e]),i=(0,u.useMemo)(()=>{let s=e.map(e=>({handle:e.handle,people:new Set(e.scoreEntries.flatMap(e=>"game"in e?e.game.result.map(e=>e.handle):[])).size,user:e})).filter(e=>!e.user.exclude).sort((e,s)=>e.people===s.people?n.get(e.handle)-n.get(s.handle):s.people-e.people);return s},[n,e]);return{rankers:s,most1st:r,mostLast:l,longest:t,matched:i}},T=()=>{let e=M(),[s,n]=(0,u.useState)(!1),l=new Map(e.rankers.map(e=>[e.handle,e.rank]));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.zx,{onClick:()=>n(e=>!e),children:"보기"}),(0,r.jsx)(i.UO,{shown:s,children:(0,r.jsx)(i.xJ,{children:(0,r.jsxs)(i.iA,{fullWidth:!0,padding:"dense",children:[(0,r.jsx)(i.ss,{children:(0,r.jsxs)(i.X2,{children:[(0,r.jsx)(i.bL,{width:"30%",children:"상격"}),(0,r.jsx)(i.bL,{width:"60%",children:"참가자"})]})}),(0,r.jsxs)(i.RM,{children:[(0,r.jsxs)(i.X2,{children:[(0,r.jsx)(i.bL,{children:(0,r.jsx)("b",{children:"전체 1–3위"})}),(0,r.jsx)(i.bL,{children:e.rankers.slice(0,10).map(e=>(0,r.jsxs)("div",{children:[e.handle," (",e.score,", ",e.rank,"위)"]},e.handle))})]}),(0,r.jsxs)(i.X2,{children:[(0,r.jsxs)(i.bL,{children:[(0,r.jsx)("b",{children:"가장 많은 1위"}),(0,r.jsx)("br",{}),"최대 3명"]}),(0,r.jsx)(i.bL,{children:e.most1st.slice(0,10).map(e=>(0,r.jsx)("div",{children:(0,r.jsxs)(i.Jd,{description:3>=(l.get(e.handle)||0),children:[e.handle," (",e.count,"회, 전체 ",l.get(e.handle)||0,"위)"]})},e.handle))})]}),(0,r.jsxs)(i.X2,{children:[(0,r.jsxs)(i.bL,{children:[(0,r.jsx)("b",{children:"가장 많은 마지막 순위"}),(0,r.jsx)("br",{}),"최대 3명"]}),(0,r.jsx)(i.bL,{children:e.mostLast.slice(0,10).map(e=>(0,r.jsx)("div",{children:(0,r.jsxs)(i.Jd,{description:3>=(l.get(e.handle)||0),children:[e.handle," (",e.count,"회, 전체 ",l.get(e.handle)||0,"위)"]})},e.handle))})]}),(0,r.jsxs)(i.X2,{children:[(0,r.jsxs)(i.bL,{children:[(0,r.jsx)("b",{children:"한 게임을 가장 오래 플레이"}),(0,r.jsx)("br",{}),"최대 5명"]}),(0,r.jsx)(i.bL,{children:e.longest.slice(0,10).map(e=>(0,r.jsx)("div",{children:(0,r.jsxs)(i.Jd,{description:3>=(l.get(e.handle)||0),children:[e.handle," (",e.minutes,"분, 전체"," ",l.get(e.handle)||0,"위)"]})},e.handle))})]}),(0,r.jsxs)(i.X2,{children:[(0,r.jsxs)(i.bL,{children:[(0,r.jsx)("b",{children:"다양한 사람과 플레이"}),(0,r.jsx)("br",{}),"최대 5명"]}),(0,r.jsx)(i.bL,{children:e.matched.slice(0,10).map(e=>(0,r.jsx)("div",{children:(0,r.jsxs)(i.Jd,{description:3>=(l.get(e.handle)||0),children:[e.handle," (",e.people,"명, 전체"," ",l.get(e.handle)||0,"위)"]})},e.handle))})]})]})]})})})]})},J=()=>{let{freezeAt:e,setFreezeAt:s}=(0,w.ek)(),n=6e4*new Date().getTimezoneOffset(),l=new Date(e-n).toISOString(),t=e=>{let n=e.target.value,r=l.split("T")[1].slice(0,5);s(new Date("".concat(n,"T").concat(r,"+09:00")).getTime())},d=e=>{let n=l.split("T")[0],r=e.target.value;s(new Date("".concat(n,"T").concat(r,"+09:00")).getTime())};return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{style:{display:"flex",gap:"0 8px"},children:[(0,r.jsx)(i.qo,{type:"date",value:l.split("T")[0],onChange:t,fullWidth:!0}),(0,r.jsx)(i.qo,{type:"time",value:l.split("T")[1].slice(0,5),onChange:d,fullWidth:!0})]})})};function S(){let e=(0,l.aC)(),[s,n]=(0,u.useState)([]),[c,o]=(0,u.useState)(new Map);return((0,u.useEffect)(()=>{if(!e.user)return;let s=(0,a.jM)((0,a.iH)(t.db,"admin_emails"),e=>{let s=[];e.forEach(e=>{e.key&&s.push(e.key)}),n(s)});return s},[e.user]),(0,u.useEffect)(()=>{let e=(0,a.jM)((0,a.iH)(t.db,"users"),e=>{let s=new Map;e.forEach(e=>{e.key&&s.set(e.key,{...e.val(),uid:e.key})}),o(s)});return e},[]),e.isAdmin)?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(i.W2,{children:[(0,r.jsx)(i.T,{h:32}),(0,r.jsx)(i.Jd,{h2:!0,children:"프리즈"}),(0,r.jsx)(J,{}),(0,r.jsx)(i.T,{h:32}),(0,r.jsx)(i.Jd,{h2:!0,children:"어워드 모드"}),(0,r.jsx)(i.T,{h:8}),(0,r.jsx)(h(),{href:"/?award=true",children:(0,r.jsx)(i.zx,{fullWidth:!0,children:"어워드 모드"})}),(0,r.jsx)(i.T,{h:8}),(0,r.jsxs)(i.Jd,{description:!0,children:[(0,r.jsx)(d.Z,{})," 키보드 버튼 Space를 눌러 진행할 수 있습니다."]}),(0,r.jsx)(i.T,{h:32}),(0,r.jsx)(i.Jd,{h2:!0,children:"관리자 목록"}),(0,r.jsx)(k,{adminUIDs:s,users:c}),(0,r.jsx)(i.T,{h:32}),(0,r.jsx)(i.Jd,{h2:!0,children:"새 관리자 추가"}),(0,r.jsx)(L,{adminUIDs:s,users:c}),(0,r.jsx)(i.T,{h:32}),(0,r.jsx)(i.Jd,{h2:!0,children:"현재 시점 상 목록"}),(0,r.jsx)(T,{}),(0,r.jsx)(i.T,{h:32})]})}):(0,r.jsx)(i.W2,{children:(0,r.jsx)(i.at,{children:"관리자가 아닙니다."})})}}},function(e){e.O(0,[3169,8454,759,4770,5697,9146,3229,5846,5066,2667,8139,1744],function(){return e(e.s=6976)}),_N_E=e.O()}]);